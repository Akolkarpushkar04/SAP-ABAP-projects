*&---------------------------------------------------------------------*
*& Report ZSMARTFORM_PROG_04
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT ZSMARTFORM_PROG_05_DUPLICATE.
DATA : LV_FNAME TYPE RS38L_FNAM.
DATA : JOB_OUTPUT_INFO_1 TYPE SSFCRESCL.
DATA : output_options_1 TYPE SSFCOMPOP.
DATA : CONTROL_PARAMETERS_1 type SSFCTRLOP.
*
TYPES: BEGIN OF LTY_DATA,
         ONO   TYPE ZDEONO_04,
         ODATE TYPE ZDEODATE_04,
         PM    TYPE ZDEPM_04,
         TA    TYPE ZDETA_04,
         CURR  TYPE ZDECUR_04,
       END OF LTY_DATA.

TYPES: BEGIN OF LTY_DATA1,
         ONO   TYPE ZDEONO_28,
         ICOST TYPE ZDEOICOST_28,
         OIN   TYPE ZDEOITMNO_28,
       END OF LTY_DATA1.

DATA : LT_HEADER_DATA TYPE TABLE OF LTY_DATA.
DATA : LT_ITEM_DATA TYPE TABLE OF LTY_DATA1.


PARAMETERS : P_ONO TYPE ZDEONO_28.
SELECT ONO ODATE PM TA CURR
  FROM ZHEADER_04
  INTO TABLE LT_HEADER_DATA
  WHERE ONO = P_ONO.

IF LT_HEADER_DATA IS NOT INITIAL.
  SELECT ONO ICOST OIN
    FROM ZITEM_04
    INTO TABLE LT_ITEM_DATA
    WHERE ONO = P_ONO.
ENDIF.




                CALL FUNCTION 'SSF_FUNCTION_MODULE_NAME'
                  EXPORTING
                    FORMNAME                 = 'ZSM_FISRT_ORDER_01'
*                   VARIANT                  = ' '
*                   DIRECT_CALL              = ' '
                 IMPORTING
                   FM_NAME                  = LV_FNAME
                 EXCEPTIONS
                   NO_FORM                  = 1
                   NO_FUNCTION_MODULE       = 2
                   OTHERS                   = 3
                          .
                IF SY-SUBRC <> 0.
* Implement suitable error handling here
                ENDIF.


* below 3 steps is for removing output device screen and print-preview button.

CONTROL_PARAMETERS_1-NO_DIALOG = 'X'.
CONTROL_PARAMETERS_1-PREVIEW ='X'.
CONTROL_PARAMETERS_1-GETOTF = 'X'.
output_options_1-TDDEST = 'LP01'.

* Declaration for OTF text format.
*DATA : JOB_OUTPUT_INFO_1 TYPE SSFCRESCL.
*CONTROL_PARAMETERS_1-GETOTF = 'X'.



    CALL FUNCTION LV_FNAME
      EXPORTING
*       ARCHIVE_INDEX              =
*       ARCHIVE_INDEX_TAB          =
*       ARCHIVE_PARAMETERS         =
       CONTROL_PARAMETERS         = CONTROL_PARAMETERS_1
*       MAIL_APPL_OBJ              =
*       MAIL_RECIPIENT             =
*       MAIL_SENDER                =
       OUTPUT_OPTIONS             = output_options_1
       USER_SETTINGS              = ' '
        P_ONO                      = P_ONO
     IMPORTING
*       DOCUMENT_OUTPUT_INFO       =
       JOB_OUTPUT_INFO            = JOB_OUTPUT_INFO_1
*       JOB_OUTPUT_OPTIONS         =
     EXCEPTIONS
       FORMATTING_ERROR           = 1
       INTERNAL_ERROR             = 2
       SEND_ERROR                 = 3
       USER_CANCELED              = 4
       OTHERS                     = 5
              .
    IF SY-SUBRC <> 0.
* Implement suitable error handling here
    ENDIF.

DATA : lines_pdf TYPE TABLE of TLINE." Tables-Lines-Lines_pdf is an internal table.
* WORK of converting OTF to PDF

    CALL FUNCTION 'CONVERT_OTF'
     EXPORTING
       FORMAT                      = 'PDF'
*       MAX_LINEWIDTH               = 132
*       ARCHIVE_INDEX               = ' '
*       COPYNUMBER                  = 0
*       ASCII_BIDI_VIS2LOG          = ' '
*       PDF_DELETE_OTFTAB           = ' '
*       PDF_USERNAME                = ' '
*       PDF_PREVIEW                 = ' '
*       USE_CASCADING               = ' '
*       MODIFIED_PARAM_TABLE        =
*     IMPORTING
*       BIN_FILESIZE                =
*       BIN_FILE                    =
      TABLES
        OTF                         = JOB_OUTPUT_INFO_1-OTFDATA " All our data came into job_output_info_1 and OTFDATA is a parameter where we get a OTF type forat which is in the data type of job_output_info_1 (line number 8).
        LINES                       = LINES_PDF
*     EXCEPTIONS
*       ERR_MAX_LINEWIDTH           = 1
*       ERR_FORMAT                  = 2
*       ERR_CONV_NOT_POSSIBLE       = 3
*       ERR_BAD_OTF                 = 4
*       OTHERS                      = 5
              .
    IF SY-SUBRC <> 0.
* Implement suitable error handling here
    ENDIF.


*  For downloading PDF.

    CALL FUNCTION 'GUI_DOWNLOAD'
      EXPORTING
*       BIN_FILESIZE                    =
        FILENAME                        = 'C:\Users\PVRN23\Desktop\smartform.pdf'
       FILETYPE                        = 'BIN'
*       APPEND                          = ' '
*       WRITE_FIELD_SEPARATOR           = ' '
*       HEADER                          = '00'
*       TRUNC_TRAILING_BLANKS           = ' '
*       WRITE_LF                        = 'X'
*       COL_SELECT                      = ' '
*       COL_SELECT_MASK                 = ' '
*       DAT_MODE                        = ' '
*       CONFIRM_OVERWRITE               = ' '
*       NO_AUTH_CHECK                   = ' '
*       CODEPAGE                        = ' '
*       IGNORE_CERR                     = ABAP_TRUE
*       REPLACEMENT                     = '#'
*       WRITE_BOM                       = ' '
*       TRUNC_TRAILING_BLANKS_EOL       = 'X'
*       WK1_N_FORMAT                    = ' '
*       WK1_N_SIZE                      = ' '
*       WK1_T_FORMAT                    = ' '
*       WK1_T_SIZE                      = ' '
*       WRITE_LF_AFTER_LAST_LINE        = ABAP_TRUE
*       SHOW_TRANSFER_STATUS            = ABAP_TRUE
*       VIRUS_SCAN_PROFILE              = '/SCET/GUI_DOWNLOAD'
*     IMPORTING
*       FILELENGTH                      =
      TABLES
        DATA_TAB                        = lines_pdf
*       FIELDNAMES                      =
     EXCEPTIONS
       FILE_WRITE_ERROR                = 1
       NO_BATCH                        = 2
       GUI_REFUSE_FILETRANSFER         = 3
       INVALID_TYPE                    = 4
       NO_AUTHORITY                    = 5
       UNKNOWN_ERROR                   = 6
       HEADER_NOT_ALLOWED              = 7
       SEPARATOR_NOT_ALLOWED           = 8
       FILESIZE_NOT_ALLOWED            = 9
       HEADER_TOO_LONG                 = 10
       DP_ERROR_CREATE                 = 11
       DP_ERROR_SEND                   = 12
       DP_ERROR_WRITE                  = 13
       UNKNOWN_DP_ERROR                = 14
       ACCESS_DENIED                   = 15
       DP_OUT_OF_MEMORY                = 16
       DISK_FULL                       = 17
       DP_TIMEOUT                      = 18
       FILE_NOT_FOUND                  = 19
       DATAPROVIDER_EXCEPTION          = 20
       CONTROL_FLUSH_ERROR             = 21
       OTHERS                          = 22
              .
    IF SY-SUBRC <> 0.
* Implement suitable error handling here
    ENDIF.